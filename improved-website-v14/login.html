<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHELP – Login</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }

        /* Dark mode palette for login page. This mirrors the dashboard dark scheme for consistency. */
        .dark-mode {
            background-color: #0f172a;
            color: #e2e8f0;
        }
        .dark-mode .bg-white,
        .dark-mode .bg-gray-50,
        .dark-mode .bg-gray-100 {
            background-color: #1e293b !important;
            color: #e2e8f0 !important;
        }
        .dark-mode .bg-gradient-to-br,
        .dark-mode .bg-gradient-to-r,
        .dark-mode .bg-gradient-to-l {
            background: #1e293b !important;
            color: #e2e8f0 !important;
        }

        /* When the same element holds both dark-mode and gradient classes (e.g. body), override as well */
        .dark-mode.bg-gradient-to-br,
        .dark-mode.bg-gradient-to-r,
        .dark-mode.bg-gradient-to-l {
            background: #1e293b !important;
            color: #e2e8f0 !important;
        }
        .dark-mode .text-gray-900,
        .dark-mode .text-gray-800 {
            color: #e2e8f0 !important;
        }
        .dark-mode .text-gray-600,
        .dark-mode .text-gray-500 {
            color: #94a3b8 !important;
        }
        .dark-mode .border-gray-300 {
            border-color: #475569 !important;
        }
    </style>
</head>
<body class="bg-gradient-to-r from-purple-200 to-orange-200">
    <!-- Top navigation bar with logo and back link -->
    <nav class="flex items-center justify-between px-6 py-4">
        <div class="flex items-center space-x-3">
            <a href="index.html" class="flex items-center space-x-3">
                <img src="Help (6).png" alt="AHELP logo" class="h-28 w-auto">
            </a>
        </div>
        <div>
            <a href="index.html" class="text-gray-600 hover:text-purple-600 text-sm">← Back to Home</a>
        </div>
    </nav>
    
    <!-- Login / Sign Up Card -->
    <div class="flex-1 flex items-center justify-center px-4 pb-12">
        <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md">
            <img src="Help (6).png" alt="AHELP logo" class="h-30 w-auto">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Welcome to AHELP</h1>
                <p class="text-gray-500">Sign in or create an account to continue</p>
            </div>
            <!-- Tabs -->
            <div class="flex bg-gray-100 rounded-xl p-1 mb-6 select-none">
                <button id="login-tab" class="flex-1 py-3 px-4 rounded-lg bg-white shadow font-medium text-gray-900 transition-all">Login</button>
                <button id="signup-tab" class="flex-1 py-3 px-4 rounded-lg font-medium text-gray-600 hover:text-gray-900 transition-all">Sign Up</button>
            </div>
            <!-- Login Form -->
            <form id="login-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent transition-all" placeholder="you@example.com">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-400 focus:border-transparent transition-all" placeholder="••••••••">
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-purple-500 to-orange-400 text-white py-3 rounded-xl font-semibold hover:from-purple-600 hover:to-orange-500 transition transform hover:scale-105">
                    Sign In
                </button>
            </form>
            <!-- Sign Up Form -->
            <form id="signup-form" class="space-y-4 hidden">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                        <input type="text" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent transition-all" placeholder="Jane">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                        <input type="text" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-400 focus:border-transparent transition-all" placeholder="Doe">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent transition-all" placeholder="you@example.com">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-400 focus:border-transparent transition-all" placeholder="••••••••">
                </div>
                <!-- Basic Health Risk Assessment -->
                <div class="mt-4 border-t pt-4">
                    <h3 class="text-lg font-semibold mb-2">Quick Health Info</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Age</label>
                            <input type="number" min="1" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent transition-all" placeholder="e.g. 30">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Gender</label>
                            <select class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-400 focus:border-transparent transition-all">
                                <option value="" disabled selected>Select</option>
                                <option value="female">Female</option>
                                <option value="male">Male</option>
                                <option value="other">Other</option>
                                <option value="na">Prefer not to say</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Height (cm)</label>
                            <input type="number" min="1" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-400 focus:border-transparent transition-all" placeholder="e.g. 170">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Weight (kg)</label>
                            <input type="number" min="1" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-400 focus:border-transparent transition-all" placeholder="e.g. 65">
                        </div>
                    </div>
                </div>
                <button type="submit" class="w-full mt-4 bg-gradient-to-r from-pink-400 to-orange-400 text-white py-3 rounded-xl font-semibold hover:from-pink-500 hover:to-orange-500 transition transform hover:scale-105">
                    Create Account
                </button>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Tab switching between login and sign up
        const loginTab = document.getElementById('login-tab');
        const signupTab = document.getElementById('signup-tab');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');

        function getCsrfToken() {
            const match = document.cookie.match(/(?:^|;\s*)XSRF-TOKEN=([^;]+)/);
            return match ? decodeURIComponent(match[1]) : '';
        }
        
        loginTab.addEventListener('click', () => {
            loginTab.classList.add('bg-white', 'shadow', 'text-gray-900');
            signupTab.classList.remove('bg-white', 'shadow', 'text-gray-900');
            signupTab.classList.add('text-gray-600');
            loginForm.classList.remove('hidden');
            signupForm.classList.add('hidden');
        });
        signupTab.addEventListener('click', () => {
            signupTab.classList.add('bg-white', 'shadow', 'text-gray-900');
            loginTab.classList.remove('bg-white', 'shadow', 'text-gray-900');
            loginTab.classList.add('text-gray-600');
            signupForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
        });

        // Handle login submission
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = loginForm.querySelector('input[type="email"]').value.trim();
            const password = loginForm.querySelector('input[type="password"]').value;
            try {
                const res = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-Token': getCsrfToken()
                    },
                    body: JSON.stringify({ email, password })
                });
                if (!res.ok) throw new Error('Login failed');
                const data = await res.json();
                localStorage.setItem('authToken', data.token);
                const name = data.user.name || email.split('@')[0];
                localStorage.setItem('ahelpUserName', name);
                localStorage.setItem('ahelpUserId', data.user.id);
                window.location.href = 'dashboard.html';
            } catch (err) {
                alert(err.message);
            }
        });
        // Handle sign up submission
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const firstName = signupForm.querySelector('input[placeholder="Jane"]').value.trim();
            const lastName = signupForm.querySelector('input[placeholder="Doe"]').value.trim();
            const email = signupForm.querySelector('input[type="email"]').value.trim();
            const password = signupForm.querySelector('input[type="password"]').value;
            const name = `${firstName} ${lastName}`.trim();
            try {
                const res = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-Token': getCsrfToken()
                    },
                    body: JSON.stringify({ email, password, name })
                });
                if (!res.ok) throw new Error('Registration failed');
                const data = await res.json();
                localStorage.setItem('authToken', data.token);
                localStorage.setItem('ahelpUserName', data.user.name || firstName);
                localStorage.setItem('ahelpUserId', data.user.id);
                window.location.href = 'dashboard.html';
            } catch (err) {
                alert(err.message);
            }
        });
    </script>
    <!-- Back to Top Button -->
    <button id="back-to-top" class="hidden fixed bottom-6 right-6 p-3 rounded-full bg-purple-500 text-white shadow-lg" aria-label="Back to top">↑</button>
    <!-- Persistence & Back‑to‑Top Script -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Apply saved dark mode across pages
        try {
          if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
          }
        } catch (e) {}
        const backBtn = document.getElementById('back-to-top');
        window.addEventListener('scroll', function() {
          if (window.scrollY > 200) {
            backBtn.classList.remove('hidden');
          } else {
            backBtn.classList.add('hidden');
          }
        });
        backBtn.addEventListener('click', function() {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
      });
    </script>
</body>
</html>